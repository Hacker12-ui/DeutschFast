<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Courses - DeutschFast</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Global styles (buttons, layout, fonts, etc.) -->
  <link rel="stylesheet" href="css/style.css" />
  <!-- Page-specific styles -->
  <link rel="stylesheet" href="css/courses.css" />
</head>
<body>
  <div class="page courses-page">
    <!-- Header -->
    <header class="header">
      <div class="logo">DeutschFast</div>
      <nav class="nav-links">
        <a href="dashboard.html">Dashboard</a>
        <a href="courses.html" class="nav-link active">Courses</a>
        <a href="lesson.html">Lessons</a>
        <a href="vocab.html">Vocab</a>
        <a href="#">Profile</a>
        <a href="login.html" class="nav-link logout-link">Log out</a>
      </nav>
    </header>

    <!-- Main content -->
    <main class="courses-main">
      <!-- Intro -->
      <section class="courses-hero">
        <h1 class="courses-title">Courses</h1>
        <p class="courses-subtitle">Choose your level and start learning.</p>
      </section>

      <!-- Level selector -->
      <section class="level-selector">
        <button class="level-pill level-pill-active">A1</button>
        <button class="level-pill">A2</button>
        <button class="level-pill">B1</button>
        <button class="level-pill">B2</button>
      </section>

      <!-- Modules grid (will be populated dynamically) -->
      <section class="modules-grid" id="modules-container">
        <!-- Module cards will be inserted here by JavaScript -->
      </section>

      <!-- How courses work -->
      <section class="courses-info">
        <h3 class="courses-info-title">How courses work</h3>
        <p class="courses-info-text">
          Each module has short lessons with listening, reading, speaking, and
          writing. Start at A1 if you are completely new to German.
        </p>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div>DeutschFast</div>
      <div class="footer-links">
        <a href="#">Contact</a>
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Use</a>
      </div>
    </footer>
  </div>

  <!-- JavaScript for dynamic module loading -->
  <script>
    // ========================================
    // MODULE LOADER
    // ========================================

    let allModules = [];
    const iconColors = ['green', 'orange', 'yellow', 'red', 'purple'];

    // Get user progress from localStorage
    function getUserProgress() {
      const saved = localStorage.getItem('moduleProgress');
      return saved ? JSON.parse(saved) : {};
    }

    // Load modules from JSON
    async function loadModules() {
      try {
        const response = await fetch('data/modules.json');
        const data = await response.json();
        allModules = data.modules;
        renderModules(allModules);
      } catch (error) {
        console.error('Error loading modules:', error);
        document.getElementById('modules-container').innerHTML = 
          '<p style="text-align: center; color: #666;">Error loading courses. Please refresh the page.</p>';
      }
    }

    // Render module cards
    function renderModules(modules) {
      const container = document.getElementById('modules-container');
      const progress = getUserProgress();
      
      container.innerHTML = ''; // Clear existing cards

      modules.forEach((module, index) => {
        // Get progress for this module
        const moduleProgress = progress[module.id] || { completedLessons: 0 };
        const completed = moduleProgress.completedLessons || 0;
        const buttonText = completed > 0 ? 'Continue' : 'Start';
        const colorClass = iconColors[index % iconColors.length];

        // Create card HTML
        const card = `
          <article class="module-card">
            <div class="module-top">
              <div class="module-icon module-icon-${colorClass}">${module.icon}</div>
              <span class="module-tag">${module.level} Â· ${module.category}</span>
            </div>
            <h2 class="module-title">${module.title}</h2>
            <p class="module-text">${module.description}</p>
            <p class="module-progress">${completed} / ${module.totalLessons} lessons completed</p>
            <button class="btn btn-primary btn-module" onclick="startModule('${module.id}')">
              ${buttonText}
            </button>
          </article>
        `;

        container.innerHTML += card;
      });
    }

    // Start or continue a module
    function startModule(moduleId) {
      const module = allModules.find(m => m.id === moduleId);
      if (!module) {
        alert('Module not found');
        return;
      }

      const progress = getUserProgress();
      const moduleProgress = progress[moduleId] || { completedLessons: 0 };
      
      // Get next lesson to open
      const nextLessonIndex = moduleProgress.completedLessons || 0;
      const nextLessonId = module.lessons[nextLessonIndex];

      // Navigate to lesson page
      window.location.href = `lesson.html?id=${nextLessonId}`;
    }

    // Initialize on page load
    loadModules();
  </script>
</body>
</html>
